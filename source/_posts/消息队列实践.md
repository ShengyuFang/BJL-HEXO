---
title: 消息队列
date: 2022-10-05 13:09:00
categories: 工作
---
### 消息队列的优点：
1. 解耦请求与处理逻辑。
2. 附带了持久化功能，防止请求丢失。
### 场景
消息队列的本质还是异步处理。适用的场景有秒杀、短信邮件通知、数据统计、监控、数据同步，分布式事务，广告计费，库存扣减以及相似业务，实时性要求没那么高的业务。不适合的场景有支付(其实也用消息队列，取决于具体业务，有些银行接口需要秒级才能返回，不得不异步化)，以及非必要不使用消息队列，因为消息队列会增加系统维护成本，增加延迟。
### 实践步骤
1. 请求处理是否需要有序? Kafka保证了同一分区内数据有序。
2. 请求处理防重复、幂等。导致数据处理重复的原因有：发送消息重试，处理消息重试，异步提交失败，消息队列内部重分区。幂等的实现方式有：依靠数据库主键、唯一ID、记录表、版本号、状态更新、锁等。
3. 给消息队列开启死信队列，以便可以恢复数据。
4. 监控消息堆积、死信队列、消息延迟等，最尴尬的是有些请求未处理并且没发现。
5. 数据安全要求非常高再加上离线审计。